from bs4 import BeautifulSoup
import requests

HEADERS = {
    "User-Agent": "Mozilla/5.0 (Linux; Android 10; SM-A107F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.74 Mobile Safari/537.36",
    "Accept-Language": "en-US,en;q=0.5",
}

def scrape(url):
    response = requests.get(url.strip(), headers=HEADERS)
    soup = BeautifulSoup(response.content, "lxml")
    try:
        title = soup.find("span", id="title").get_text(strip=True)
    except AttributeError:
        title = "NA"

    try:
        rating = soup.find("span", class_="a-icon-alt").get_text(strip=True)
    except AttributeError:
        rating = "NA"

    try:
        availability = soup.find("span", id="availability").get_text(strip=True)
    except AttributeError:
        availability = "NA"

    try:
        price = soup.find("span", class_="a-price-whole").get_text(strip=True)
        price = price.replace(",", "")
    except AttributeError:
        price = "NA"

    return title, rating, availability, price


if __name__ == "__main__":
    print("Starting the Scraper")

    with open("C:\\vsc SA\\projects\\Data science\\url.txt", "r") as url_file, \
         open("C:\\vsc SA\\projects\\Data science\\target.csv", "a", encoding="utf-8") as out_file:
        
        out_file.write("Title,Rating,Availability,Price\n")

        for link in url_file:
            
            title, rating, availability,price = scrape(link)
            out_file.write(f"{title},{rating},{availability},{price}\n")
            

    print("Scraping complete ")

